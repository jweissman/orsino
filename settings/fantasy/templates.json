{
  "deity": {
    "domain": "=oneOf(light, darkness, nature, war, knowledge, trickery, life, death, magic, order, chaos, oceans, love, storms)",
    "alignment": "=(#domain == light || #domain == life || #domain == order || #domain == knowledge) ? good : ((#domain == darkness || #domain == death || #domain == chaos || #domain == trickery) ? evil : neutral)",
    "blessing": "=lookup(deityBlessings, #domain)",
    "forename": "=lookup(deityName, #domain)",
    "gender": "=lookup(deityGender, #forename)",
    "title": "=#gender == 'male' ? oneOf('God', 'Lord') : oneOf('Goddess')",
    "name": "=\"#forename, #title of #{capitalize(#domain)}\""
  },
  "town": {
    "terrain": "=lookup(terrains, 1d6)",
    "size": "=oneOf(hamlet, village, town, city, metropolis, capital)",
    "race": "=oneOf(human, elf, dwarf, halfling, gnome, fae, orc)",
    "deity": "=gen(deity)",
    "capital": "=#size == 'capital'",
    "population": "=eval(lookup(townPop, #size))",
    "_aspect": "=lookup(terrainFeatures, #terrain)",
    "_suffix": "=oneOf(ford, haven, burg, port, dale, keep, watch, gate, rest, fall, ridge, wood, field, pass, hold, stead, view, point, hill, bay, cliff, cross, run, land, bridge, shore, town, ville, ton, mouth, burg, bury, bold, wick, ton, ham, worth, edge, bay, vale)",
    "name": "=capitalize(#_aspect + #_suffix)",
    "adjective": "=oneOf(peaceful, bustling, prosperous, decaying, ancient, vibrant, sleepy, lively, fair, grim, quaint, thriving, quiet, rustic, quaint, noble, humble, proud)"
  },
  "pc": {
    "hair": "=oneOf(black, brown, blonde, red, gray, white, no, sandy, auburn, chestnut, silver, golden)",
    "eye_color": "=oneOf(brown, blue, green, gray, hazel, amber, violet, olive, gold)",
    "alignment": "=oneOf(good, neutral)",
    "order": "=oneOf(lawful, neutral, chaotic)",
    "archetype": "=lookup(alignmentArchetypes, #order + ' ' + #alignment)",
    "background": "=oneOf(noble, soldier, outlander, scholar, criminal, artisan, acolyte, hermit)",
    "personality": "=#background == 'noble' ? oneOf(proud, haughty, dignified, commanding) : oneOf(grim, bold, cunning, loyal, compassionate, ruthless, cheerful, brooding, curious, jovial, acerbic, stoic, wary)",
    "_hometown": "=gen(town)",
    "hometown": "=capitalize(dig(#_hometown, 'size')) + ' of ' + dig(#_hometown, 'name')",
    "gender": "=oneOf(male, female, androgynous)",
    "body_type": "=gender == 'female' ? oneOf(petite, slim, average, athletic, svelte, curvy, robust) : oneOf(slim, average, athletic, stocky, burly, outsized)",
    "race": "=oneOf(human, orc, elf, dwarf, halfling, gnome, fae)",
    "class": "=oneOf(warrior, mage, thief, cleric, bard, ranger)",
    "age": "=16 + 2d20 + if(#race == \"elf\", 100, if(#race == \"dwarf\", 50, 0))",
    "_surname": "=lookup(surname, #class)",
    "forename": "=lookupUnique(name, #gender)",
    "name": "=#forename + \" \" + #_surname",
    "referenceName": "='the ' + #race + ' ' + #class + oneOf(' named ', ' known as ') + #forename",
    "str": "=3d6",
    "dex": "=3d6",
    "int": "=3d6",
    "wis": "=3d6",
    "cha": "=3d6",
    "con": "=3d6",
    "hitDie": "=lookup(hitDie, #class)",
    "maxHp": "=#hitDie + max(0,statMod(#con))",
    "level": 1,
    "xp": 0,
    "weapon": "=oneOf(lookup(weapon, #class))",
    "_weaponStat": "=lookup(masterWeapon, #weapon)",
    "damageKind": "=dig(#_weaponStat, 'type')",
    "attackDie": "=dig(#_weaponStat, 'damage')",
    "armor": "=lookup(armor, #class)",
    "ac": "=10 - lookup(masterArmor, #armor)",
    "gp": "=1d100",
    "hasMissileWeapon": "=!!dig(#_weaponStat, 'missile')",
    "hasInterceptWeapon": "=!!dig(#_weaponStat, 'intercept')",
    "primaryAttack": "=if(#hasMissileWeapon, 'ranged', 'melee')",
    "abilities": "=concat(#primaryAttack, lookup(abilities, #class))",
    "traits": "=concat(humanoid, lookup(traits, #race))",
    "gear": "=gather(masterGear, 2d4 + 1)",
    "*classModifier": "=lookup(classModifier, #class)",
    "*backgroundModifier": "=lookup(backgroundModifier, #background)",
    "*racialModifier": "=lookup(racialModifier, #race)",
    "hp": "=#maxHp"
  },
  "animal": {
    "alignment": "animal",
    "challenging": false,
    "gender": "=oneOf(male, female, neutral)",
    "background": "=oneOf(wild, trained)",
    "hometown": "the wilds",
    "hair": "=oneOf(black, white, brown, gray, spotted, striped)",
    "eye_color": "=oneOf(brown, blue, green, amber)",
    "personality": "=oneOf(aggressive, loyal, timid, curious, playful, fierce)",
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "race": "=oneOf(goblin, kobold, orc, human, ogre, troll, dragon, human, elf, dwarf, halfling, gnome, fae)",
    "age": "=5+1d10",
    "animal_type": "=lookup(companionType, #race)",
    "forename": "=lookupUnique(companionName, #animal_type)",
    "animal_aspect": "=lookup(creatureAspectTypes, if(#challenging, oneOf(rare, legendary), oneOf(common, uncommon)))",
    "class": "=capitalize(#terrain) + ' ' + capitalize(#animal_type)",
    "kind": "=#background != 'wildtype' ? capitalize(#background) : ''",
    "name": "=capitalize(#animal_aspect) + ' ' + capitalize(#forename)",
    "_statLine": "=lookup(animalStat, #animal_type)",
    "_statBase": 3,
    "level": 1,
    "str": "=dig(#_statLine, 'str')+#_statBase+round(#level/8)",
    "dex": "=dig(#_statLine, 'dex')+#_statBase+round(#level/8)",
    "con": "=dig(#_statLine, 'con')+#_statBase+round(#level/8)",
    "int": "=dig(#_statLine, 'int')+#_statBase+round(#level/8)",
    "wis": "=dig(#_statLine, 'wis')+#_statBase+round(#level/8)",
    "cha": "=dig(#_statLine, 'cha')+#_statBase+round(#level/8)",
    "maxHp": "=max(1,2+dig(#_statLine, 'hp') + max(0,statMod(#con)) + round(#level/4))",
    "weapon": "=lookup(animalWeapon, #animal_type)",
    "hasMissileWeapon": false,
    "_weaponStat": "=lookup(masterWeapon, #weapon)",
    "damageKind": "=dig(#_weaponStat, 'type')",
    "attackDie": "=dig(#_weaponStat, 'damage')",
    "_naturalArmor": "=lookup(animalNaturalArmor, #animal_type)",
    "ac": "=10 - #_naturalArmor",
    "abilities": [
      "melee",
      "defend",
      "flee"
    ],
    "xp": "=10*#level",
    "gp": 0,
    "*terrainModifier": "=lookup(terrainModifier, #terrain)",
    "*aspectModifier": "=lookup(creatureAspects, #animal_aspect)",
    "hp": "=#maxHp"
  },
  "monster": {
    "_targetCr": 1,
    "alignment": "evil",
    "rank": "=#_targetCr < 5 ? oneOf(lesser, minor) : pick(gather(monsterRank))",
    "background": "=oneOf(wandering, guardian)",
    "terrain": "=lookup(terrains, 1d6)",
    "body_type": "=oneOf(slim, average, bulky, towering)",
    "hair": "=oneOf(dark, light, no, matted, spiky, sleek)",
    "building_type": "=oneOf(mine, fortress, temple, tomb, library)",
    "_class": "=if(#building_type == 'tomb', undead, oneOf(giant, demon, elemental, beast, aberration, celestial, construct, fey))",
    "monster_type": "=lookup(monsterKind, #_class)",
    "class": "=lookup(monsterTypeClass, #monster_type)",
    "_isOutsider": "=#class == 'elemental' || #class == 'celestial' || #class == 'demon' || #class == 'aberration'",
    "age": "=#_isOutsider ? 10d100 : 10d10",
    "monster_aspect_type": "=if(#_isOutsider, legendary, oneOf(common, uncommon, rare))",
    "monster_aspect": "=lookup(creatureAspectTypes, #monster_aspect_type)",
    "kind": "=#monster_aspect != 'wildtype' ? capitalize(#monster_aspect) : ''",
    "statLine": "=lookup(monsterStat, #class)",
    "statBase": "=lookup(monsterStatBase, #class)",
    "level": 1,
    "str": "=max(3, dig(#statLine, 'str')+#statBase+round(#level/8))",
    "dex": "=max(3, dig(#statLine, 'dex')+#statBase+round(#level/8))",
    "con": "=max(3, dig(#statLine, 'con')+#statBase+round(#level/8))",
    "int": "=max(3, dig(#statLine, 'int')+#statBase+round(#level/8))",
    "wis": "=max(3, dig(#statLine, 'wis')+#statBase+round(#level/8))",
    "cha": "=max(3, dig(#statLine, 'cha')+#statBase+round(#level/8))",
    "weapon": "=lookup(monsterWeapon, #class)",
    "traits": "=lookup(monsterTraits, #class)",
    "hasMissileWeapon": false,
    "_weaponStat": "=lookup(masterWeapon, #weapon)",
    "damageKind": "=dig(#_weaponStat, 'type')",
    "attackDie": "=dig(#_weaponStat, 'damage')",
    "attacksPerTurn": "=lookup(monsterAttacksPerTurn, #class)",
    "_naturalArmor": "=lookup(monsterNaturalArmor, #class)",
    "ac": "=10 - #_naturalArmor",
    "_baseAbilities": "=lookup(monsterAbilities, #class)",
    "element": "=if(#class == 'elemental', lookup(elements, #terrain), nihil)",
    "_elementalAbilities": "=if(#class == 'elemental', lookup(elementalAbilities, #element), nihil)",
    "substance": "=if(#monster_type == 'Golem', pick(gather(golemSubstances)), nihil)",
    "_typeAbilities": "=lookup(monsterTypeAbilities, #monster_type)",
    "_aspectAbilities": "=lookup(creatureAspectAbilities, #monster_aspect)",
    "hometown": "=#class == 'elemental' ? \"plane of #element\" : lookup(monsterHome, #class)",
    "abilities": "=uniq(concat(#_baseAbilities, #_elementalAbilities, #_typeAbilities, #_aspectAbilities))",
    "forename": "=(#substance ? capitalize(#substance) + ' ' : '') + (#element ? capitalize(#element) + ' ' : '') + capitalize(#monster_type)",
    "xp": "=lookup(monsterXp, #class) + 50*#level",
    "gp": "=lookup(monsterGold, #class)",
    "*terrainModifier": "=lookup(terrainModifier, #terrain)",
    "*aspectModifier": "=lookup(creatureAspects, #monster_aspect)",
    "*typeModifier": "=lookup(monsterTypeModifier, #monster_type)",
    "*substanceModifier": "=if(#substance, lookup(golemSubstances, #substance), nihil)",
    "maxHp": "=max(1,dig(#statLine, 'hp') + statMod(#con) + #level * 3)",
    "*rankModifier": "=lookup(monsterRank, #rank)",
    "archetype": "=#class",
    "_name": "=(#kind != '' ? capitalize(#kind) + ' ' : '') + (#rank != 'standard' ? capitalize(#rank) + ' ' : '') + (#substance ? capitalize(#substance) + ' ' : '') + capitalize(#monster_type)",
    "name": "=if(#class == 'elemental', capitalize(#kind) + ' ' + (#rank != 'standard' ? capitalize(#rank) + ' ' : '') + capitalize(#element) + ' ' + capitalize(#monster_type), #_name)",
    "hp": "=#maxHp"
  },
  "npc": {
    "_targetCr": 1,
    "_index": 0,
    "challenging": false,
    "alignment": "evil",
    "order": "=oneOf(lawful, neutral, chaotic)",
    "archetype": "=lookup(alignmentArchetypes, #order + ' ' + #alignment)",
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "race": "=oneOf(goblin, kobold, orc, human, ogre, troll, elf, dwarf, halfling, gnome, fae, dragon)",
    "building_type": "=oneOf(mine, fortress, temple, tomb, library)",
    "_npc_types": "=lookup(npcTypesForDungeon, #building_type)",
    "npc_type": "=pick(#_npc_types, #_index)",
    "forename": "=lookupUnique(npcName, #race)",
    "rank": "=#challenging ? oneOf(veteran, champion, elite, paragon) : oneOf(peasant, grunt, untested, rookie, seargeant, captain)",
    "npc_aspect_rarity": "=if(#challenging, oneOf(epic, legendary), oneOf(common, uncommon, rare))",
    "npc_aspect": "=lookup(creatureAspectTypes, #npc_aspect_rarity)",
    "_npc_template_type_expr": null,
    "npc_template_type": "=#_npc_template_type_expr != nihil ? eval(#_npc_template_type_expr) : nihil",
    "npc_template": "=#npc_template_type != nihil ? lookup(creatureTemplateOverlays, #npc_template_type) : nihil",
    "class": "=if(#challenging, capitalize(#rank) + ' ', '') + #npc_type",
    "kind": "=(#npc_template_type != nihil ? capitalize(#npc_template) + ' ' : '') + capitalize(#race)",
    "name": "=(#npc_aspect != wildtype ? capitalize(#npc_aspect) + ' ' : '') + #forename",
    "referenceName": "='the ' + capitalize(#race) + ' ' + #npc_type + oneOf(' named ', ' known as ') + #forename",
    "_statLine": "=lookup(npcStat, #race)",
    "level": "=#_targetCr",
    "str": "=dig(#_statLine, 'str')+round(#level/8)",
    "dex": "=dig(#_statLine, 'dex')+round(#level/8)",
    "con": "=dig(#_statLine, 'con')+round(#level/8)",
    "int": "=dig(#_statLine, 'int')+round(#level/8)",
    "wis": "=dig(#_statLine, 'wis')+round(#level/8)",
    "cha": "=dig(#_statLine, 'cha')+round(#level/8)",
    "weapon": "=if(#npc_type == 'Slinger', 'sling', lookup(npcWeapon, #race))",
    "_weaponStat": "=lookup(masterWeapon, #weapon)",
    "hasMissileWeapon": "=!!dig(#_weaponStat, 'missile')",
    "primaryAttack": "=if(#hasMissileWeapon, 'ranged', 'melee')",
    "_abilities": [ "defend", "flee" ],
    "abilities": "=uniq(concat(#primaryAttack, #_abilities))",
    "traits": [ "humanoid" ],
    "*terrainModifier": "=lookup(terrainModifier, #terrain)",
    "*typeModifier": "=lookup(npcTypeModifier, #npc_type)",
    "*aspectModifier": "=lookup(creatureAspects, #npc_aspect)",
    "*template": "=#npc_template != nihil ? lookup(creatureTemplateModifiers, #npc_template) : nihil",
    "hitDie": "=dig(#_statLine, 'hitDie')",
    "_maxHp": "=max(2, round(#hitDie + ((#level-1) * #hitDie/2) + statMod(#con)))",
    "maxHp": "=#challenging ? max(30, #_maxHp) : #_maxHp",
    "_naturalArmor": "=dig(#_statLine, 'naturalArmor')",
    "armor": "=lookup(npcArmor, #race)",
    "_armorBonus": "=lookup(masterArmor, #armor)",
    "ac": "=10 - #_naturalArmor - #_armorBonus",
    "damageKind": "=dig(#_weaponStat, 'type')",
    "attackDie": "=dig(#_weaponStat, 'damage')",
    "xp": "=lookup(npcXp, #race) + 25*#level",
    "gp": "=lookup(npcGold, #race)",
    "*rankModifier": "=lookup(npcRank, #rank)",
    "hp": "=#maxHp"
  },
  "combatEntity": {
    "entity_type": "=oneOf(turret, antimagic_ward, barrier, bomb)",
    "name": "=humanize(#entity_type)",
    "race": "=oneOf(goblin, kobold, orc, human, ogre, troll, dragon, human, elf, dwarf, halfling, gnome, fae)",
    "forename": "=#name",
    "level": 1,
    "str": 3,
    "dex": 3,
    "con": 3,
    "int": 3,
    "wis": 3,
    "cha": 3,
    "maxHp": 14,
    "ac": 10,
    "traits": ["inanimate"],
    "_abilities": ["wait"],
    "abilities": "=concat(#_abilities, lookup(combatEntityAbilities, #entity_type))",
    "damageKind": "true",
    "attackDie": "1d2",
    "xp": 0,
    "gp": 0,
    "hp": "=#maxHp"
  },
  "encounter": {
    "_targetCr": 1,
    "race": "=if(#_targetCr <= 5, oneOf(goblin, kobold), if(#_targetCr <= 10, oneOf(orc, human), if(#_targetCr <= 18, oneOf(ogre, troll), oneOf(dragon))))",
    "targetCr": "=#_targetCr",
    "building_type": "tomb",
    "_levelBudget": "=#targetCr",
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "_companionCount": "=1d2-1",
    "_monsterCount": 0,
    "_npcCount": "=1d2",
    "_npcBudget": "=max(2,floor(#_levelBudget * #_npcCount/(#_monsterCount + #_companionCount + #_npcCount)))",
    "_npcLevelDistribution": "=distribute(#_npcBudget, #_npcCount)",
    "npcLevels": "=#_npcLevelDistribution",
    "npc_aspect_rarity": "=if(#targetCr <= 1, 'common', if(#targetCr <= 3, oneOf(common, uncommon), if(#targetCr <= 6, oneOf(uncommon, rare), oneOf(rare, epic))))",
    "_npcs": "=mapGenList(npc, #_npcLevelDistribution, 'level')",
    "bossName": "=dig(#_npcs, 0, 'referenceName')",
    "_monsterBudget": "=floor(#_levelBudget * #_monsterCount/(#_monsterCount + #_companionCount + #_npcCount))",
    "_monsterLevelDistribution": "=distribute(#_monsterBudget, #_monsterCount)",
    "_monsters": "=mapGenList(monster, #_monsterLevelDistribution, 'level')",
    "_companionBudget": "=floor(#_levelBudget * #_companionCount/(#_monsterCount + #_companionCount + #_npcCount))",
    "_companionLevelDistribution": "=distribute(#_companionBudget, #_companionCount)",
    "_companions": "=mapGenList(animal, #_companionLevelDistribution, level)",
    "_otherCombatEntityCount": "=1d10 > 7 ? 1 : 0",
    "_otherCombatEntityTypes": "=sample(lookup(otherCombatEntityTypes, #building_type), #_otherCombatEntityCount)",
    "_otherCombatEntities": "=mapGenList(combatEntity, #_otherCombatEntityTypes, 'entity_type')",
    "creatures": "=concat(#_npcs, #_companions, #_monsters, #_otherCombatEntities)",
    "bonusGold": "=1d20 + 2 * count(#creatures)",
    "cr": "=round(sum(#creatures, 'level'))"
  },
  "shrine": {
    "deity": "=gen(deity)",
    "_deityName": "=dig(#deity, 'forename')",
    "_deityAlignment": "=dig(#deity, 'alignment')",
    "blessing": "=dig(#deity, 'blessing')",
    "effects": "=concat((#_deityAlignment == 'good') ? fxHeal('=1d3') : fxDamage('=1d3', oneOf(necrotic, radiant)), fxBuff(\"#{#_deityName}'s Favor\", #blessing))",
    "_appearance": "=oneOf(ancient, 'well-maintained', ornate, simple, overgrown, hidden, glowing, cracked, majestic, humble)",
    "_shrine_type": "=oneOf(altar, statue, fountain, obelisk, mural, relic)",
    "name": "=capitalize(#_shrine_type) + ' of ' + dig(#deity, 'name')",
    "description": "=\"#_appearance #_shrine_type dedicated to #_deityName\"",
    "offer": "=1d4 + 1"
  },
  "room": {
    "_targetCr": 1,
    "_index": 0,
    "__building_type": "=oneOf(temple, fortress, library, tomb, mine)",
    "building_type": "=oneOf(temple, tomb)",
    "_roomBias": "=lookup(roomBias, #building_type)",
    "room_type": "=pick(#_roomBias)",
    "narrative": "=lookup(roomNarrative, #room_type)",
    "room_size": "=oneOf(tiny, small, medium, large, enormous)",
    "_encounterChance": 1,
    "_treasureChance": "=if(#room_type == \"treasury\", 1.0, oneOf(0.5, 0.8))",
    "targetCr": "=#_targetCr + max(0,round(#_index/3)-1)",
    "challenging": false,
    "*specialRoomModifiers": "=hasEntry(specialRooms, #room_type) ? lookup(specialRooms, #room_type) : nihil",
    "encounter": "=if(rand() < #_encounterChance, gen(encounter), nihil)",
    "_treasureItems": "=lookup(treasure, rand() < 0.8 ? oneOf(negligible, minor) : oneOf(minor, major))",
    "treasure": "=if(rand() < #_treasureChance, sample(#_treasureItems, 1d2), nihil)",
    "decor": "=lookup(roomDecoration, 1d100)",
    "gear": "=gather(masterGear, 1)",
    "features": "=uniq(gather(roomFeature, if(rand() < 0.3, 2, 1)))",
    "aura": "=lookup(roomAuras, hasEntry(specialRoomAuras, #room_type) ? lookup(specialRoomAuras, #room_type) : oneOf(calm, energizing))",
    "shrine": "=gen(shrine)"
  },
  "boss_room": {
    "_targetCr": 1,
    "depth": 0,
    "race": "goblin",
    "challenging": true,
    "__building_type": "=oneOf(temple, fortress, library, tomb, mine)",
    "building_type": "tomb",
    "room_type": "=oneOf(throne_room, lair, altar)",
    "narrative": "=lookup(roomNarrative, #room_type)",
    "room_size": "=oneOf(medium, large, enormous, huge, colossal)",
    "targetCr": "=#_targetCr + round(#depth/3)",
    "_npcCount": 1,
    "_companionCount": 1,
    "_monsterCount": 1,
    "treasure": "=lookup(treasure, oneOf(minor, major))",
    "npc_type": "=lookup(bossNpcTypesForDungeon, #building_type)",
    "boss_encounter": "=gen(encounter)",
    "decor": "=lookup(roomDecoration, 1d100)",
    "gear": "=gather(masterGear, 1d3 + 2)",
    "features": "=gather(roomFeature, if(rand() < 0.3, 2, 1))"
  },
  "dungeon": {
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "_index": 0,
    "_moduleLevel": 1,
    "_targetCr": "=#_moduleLevel + round(#_index)",
    "__building_type": "=oneOf(temple, fortress, library, tomb, mine)",
    "building_type": "tomb",
    "_roomBias": "=lookup(roomBias, #building_type)",
    "dungeon_type": "=lookup(dungeonTypes, #building_type)",
    "race": "=if(#_targetCr <= 5, oneOf(goblin, kobold), if(#_targetCr <= 10, oneOf(orc, human), if(#_targetCr <= 15, oneOf(ogre, troll), oneOf(dragon))))",
    "theme": "=oneOf(pain, power, darkness, nature, fire, ice, shadow, light, chaos, order, water, air, earth, lightning, death, life, time, mystery)",
    "domain": "=oneOf(light, darkness, nature, war, knowledge, trickery, life, death, magic, order, chaos, oceans, love, storms)",
    "dungeon_aspect": "=lookup(dungeonAspect, #building_type)",
    "_dungeon_name": "=capitalize(#dungeon_aspect) + \" \" + capitalize(#race) + \" \" + capitalize(#dungeon_type) + \" of \" + capitalize(#theme)",
    "dungeon_name": "=\"#{capitalize(#dungeon_aspect)} #{capitalize(#race)} #{capitalize(#dungeon_type)} of #{capitalize(#domain)}\"",
    "depth": "=5+4d6",
    "dungeonIndex": "=#_index",
    "intendedCr": "=#_targetCr",
    "^dungeonOverlay": "=lookup(dungeonOverlay, #building_type)",
    "rooms": "=genList(room, #depth)",
    "bossRoom": "=gen(boss_room)",
    "direction": "=oneOf(north, south, east, west)",
    "bossName": "=dig(#bossRoom, 'boss_encounter', 'bossName')",
    "_macguffins": "=lookup(treasure, legendary)",
    "macguffin": "=pick(#_macguffins)",
    "bad_outcome": "=oneOf('the land falls into chaos', 'darkness spreads across the realm', 'the forces of evil grow stronger', 'nature itself is corrupted', 'the balance of power is shattered')",
    "goal": "=\"retrieve #macguffin from the #dungeon_type before #bad_outcome\"",
    "rumor": "=eval(lookup(dungeonRumor, #building_type))"
  },
  "module": {
    "terrain": "=lookup(terrains, 1d6)",
    "town": "=gen(town)",
    "_townName": "=dig(#town, 'name')",
    "dungeons": "=genList(dungeon, 6)",
    "_moduleLevel": 0,
    "name": "=oneOf('Adventure', 'Saga', 'Reckoning', 'Quest', 'Expedition') + ' ' + oneOf('in the ' + capitalize(#terrain), 'at ' + capitalize(#_townName), 'for the ' + capitalize(#terrain))"
  }
}