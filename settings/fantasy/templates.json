{
  "town": {
    "terrain": "=lookup(terrains, 1d6)",
    "size": "=oneOf(hamlet, village, town, city, metropolis, capital)",
    "race":"=oneOf(human, elf, dwarf, halfling, gnome, fae)",
    "deity": "=oneOf(lookup(deity, #race))",
    "capital": "=#size == 'capital'",
    "population": "=eval(lookup(townPop, #size))",
    "_aspect": "=lookup(terrainFeatures, #terrain)",
    "_suffix": "=oneOf(ford, haven, burg, port, dale, keep, watch, gate, rest, fall, ridge, wood, field, pass, hold, stead, view, point, hill, bay, cliff, cross)",
    "name": "=capitalize(#_aspect + #_suffix)",
    "adjective": "=oneOf(peaceful, bustling, prosperous, decaying, ancient, vibrant, sleepy, lively, fair, grim, quaint, thriving, quiet, rustic, quaint, noble, humble, proud)"
  },
  "pc": {
    "background": "=oneOf(noble, soldier, outlander, scholar, criminal, artisan, acolyte, hermit)",
    "_hometown": "=gen(town)",
    "hometown": "=capitalize(dig(#_hometown, 'size')) + ' of ' + dig(#_hometown, 'name')",
    "gender": "=oneOf(male, female, neutral)",
    "race": "=oneOf(human, orc, elf, dwarf, halfling, gnome, fae)",
    "class": "=oneOf(warrior, mage, thief, cleric, bard, ranger, sage)",
    "age": "=16 + 2d20 + if(#race == \"elf\", 100, if(#race == \"dwarf\", 50, 0))",
    "_surname": "=lookup(surname, #class)",
    "forename": "=lookup(name, #gender)",
    "name": "=#forename + \" \" + #_surname",
    "str": "=rollWithDrop(4,6)",
    "dex": "=rollWithDrop(4,6)",
    "int": "=rollWithDrop(4,6)",
    "wis": "=rollWithDrop(4,6)",
    "cha": "=rollWithDrop(4,6)",
    "con": "=rollWithDrop(4,6)",
    "maxHp": "=lookup(hitPoints, #class) + max(0,statMod(#con))",
    "hp": "=#maxHp",
    "level": 1,
    "xp": 0,
    "weapon": "=oneOf(lookup(weapon, #class))",
    "damageDie": "=lookup(damageDie, #weapon)",
    "attackRolls": "=lookup(attackRolls, #weapon)",
    "armor": "=lookup(armor, #class)",
    "ac": "=10 - lookup(armorClassBonus, #armor)",
    "gp": "=1d100",
    "abilities": "=lookup(abilities, #class)",
    "hitDie": "=lookup(hitDie, #class)",
    "traits": "=lookup(traits, #race)",
    "*backgroundModifier": "=lookup(backgroundModifier, #background)",
    "*racialModifier": "=lookup(racialModifier, #race)"
  },
  "npc": {
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "race": "=oneOf(goblin, kobold, orc, human, ogre, troll, dragon)",
    "type": "=lookup(npcType, #race)",
    "forename": "=lookup(npcName, #race)",
    "_class": "=capitalize(#terrain) + \" \" + capitalize(#race) + \" \" + #type",
    "name": "=#forename + \", \" + #_class",
    "level": "=lookup(npcLevel, #race)",
    "_baseHp": "=lookup(npcBaseHp, #race)",
    "_hpVariance": "=lookup(npcHpVariance, #race)",
    "str": "=lookup(npcStr, #race)",
    "dex": "=lookup(npcDex, #race)",
    "con": "=lookup(npcCon, #race)",
    "int": "=lookup(npcInt, #race)",
    "wis": "=lookup(npcWis, #race)",
    "cha": "=lookup(npcCha, #race)",
    "maxHp": "=max(2, #_baseHp + round(rand()*#_hpVariance + #level / 3))",
    "_naturalArmor": "=lookup(npcNaturalArmor, #race)",
    "armor": "=if(#level >= 5, 'plate', if(#level >= 3, 'chainmail', 'leather'))",
    "armorBonus": "=lookup(armorClassBonus, #armor)",
    "ac": "=10 - #_naturalArmor - #armorBonus - statMod(#dex)",
    "weapon": "=if(#type == 'Slinger', 'sling', lookup(npcWeapon, #race))",
    "damageDie": "=lookup(damageDie, #weapon)",
    "attackRolls": "=lookup(attackRolls, #weapon)",
    "xp": "=lookup(npcXp, #race) * #level",
    "gp": "=lookup(npcGold, #race)",
    "abilities": ["melee", "defend", "wait", "flee"],
    "*terrainModifier": "=lookup(terrainModifier, #terrain)",
    "*typeModifier": "=lookup(npcTypeModifier, #type)",
    "hp": "=#maxHp"
  },
  "animal": {
    "challenging": false,
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "race": "=oneOf(goblin, kobold, orc, human, ogre, troll, dragon)",
    "animal_type": "=lookup(companionType, #race)",
    "forename": "=lookup(companionName, #animal_type)",
    "animal_aspect": "=if(#challenging, lookup(companionAspect, 1d6), nihil)",
    "description": "=if(#animal_aspect, capitalize(#animal_aspect) + ' ', '') + capitalize(#terrain) + \" \" + capitalize(#animal_type)",
    "name": "=capitalize(#forename) + \", \" + capitalize(#description)",
    "level": "=lookup(companionLevel, #animal_type)",
    "str": "=lookup(animalStrength, #animal_type)",
    "dex": "=lookup(animalDex,  #animal_type)",
    "con": "=lookup(animalCon,  #animal_type)",
    "int": "=lookup(animalInt,  #animal_type)",
    "wis": "=lookup(animalWis,  #animal_type)",
    "cha": "=lookup(animalCha,  #animal_type)",
    "maxHp": "=lookup(animalHp, #animal_type)",
    "weapon": "=lookup(animalWeapon, #animal_type)",
    "damageDie": "=lookup(damageDie, #weapon)",
    "attackRolls": "=lookup(attackRolls, #weapon)",
    "_naturalArmor": "=lookup(animalNaturalArmor, #animal_type)",
    "ac": "=10 - #_naturalArmor - statMod(#dex)",
    "abilities": ["melee", "defend", "flee"],
    "xp": "=2 * #level",
    "gp": 0,
    "*terrainModifier": "=lookup(terrainModifier, #terrain)",
    "*aspectModifier": "=lookup(companionAspectOverlay, #animal_aspect)",
    "hp": "=#maxHp"
  },
  "monster": {
    "terrain": "=lookup(terrains, 1d6)",
    "monster_type": "=oneOf(giant, demon, elemental, beast, aberration, undead, celestial, construct, fey)",
    "kind": "=lookup(monsterKind, #monster_type)",
    "aspect": "=oneOf(curious, vicious, ancient, cunning, savage, majestic, mysterious, terrifying, noble, feral)",
    "_name": "=capitalize(#aspect) + ' ' + capitalize(#kind)",
    "_statLine": "=lookup(monsterStat, #monster_type)",
    "_statBase": "=lookup(monsterStatBase, #monster_type)",
    "str": "=dig(#_statLine, 'str')+#_statBase",
    "dex": "=dig(#_statLine, 'dex')+#_statBase",
    "con": "=dig(#_statLine, 'con')+#_statBase",
    "int": "=dig(#_statLine, 'int')+#_statBase",
    "wis": "=dig(#_statLine, 'wis')+#_statBase",
    "cha": "=dig(#_statLine, 'cha')+#_statBase",
    "maxHp": "=dig(#_statLine, 'hp')",
    "weapon": "=lookup(monsterWeapon, #monster_type)",
    "damageDie": "=lookup(damageDie, #weapon)",
    "attackRolls": "=lookup(attackRolls, #weapon)",
    "attacksPerTurn": "=lookup(monsterAttacksPerTurn, #monster_type)",
    "_naturalArmor": "=lookup(monsterNaturalArmor, #monster_type)",
    "ac": "=10 - #_naturalArmor - statMod(#dex)",
    "*terrainModifier": "=lookup(terrainModifier, #terrain)",
    "hp": "=#maxHp",
    "xp": "=lookup(monsterXp, #monster_type)",
    "gp": "=lookup(monsterGold, #monster_type)",
    "_baseAbilities": "=lookup(monsterAbilities, #monster_type)",
    "_element": "=if(#monster_type == 'elemental', lookup(elements, #terrain), nihil)",
    "forename": "=capitalize(#kind)",
    "name": "=if(#monster_type == 'elemental', capitalize(#aspect) + ' ' + capitalize(#_element) + ' ' + capitalize(#kind), #_name)",
    "_elementalAbilities": "=if(#monster_type == 'elemental', lookup(elementalAbilities, #_element), nihil)",
    "abilities": "=concat(#_baseAbilities, #_elementalAbilities)",
    "level": "=lookup(monsterLevel, #monster_type)"
  },
  "encounter": {
    "targetCr": "=#_targetCr",
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "_npcCount": "=2+1d4",
    "_npcs": "=genList(npc, #_npcCount, \"=round(sum(#__items, 'level')) <= #targetCr\")",
    "_companionCount": "=1d2",
    "_companions": "=genList(animal, #_companionCount)",
    "_monsterCount": 0,
    "_monsters": "=genList(monster, #_monsterCount, \"=round(sum(#__items, 'level')) <= #targetCr\")",
    "creatures": "=concat(#_npcs, #_companions, #_monsters)",
    "bonusGold": "=2d20 + 5 * count(#creatures)",
    "cr": "=round(sum(#_npcs, 'level'))"
  },
  "room": {
    "_targetCr": "1",
    "_index": "0",
    "_roomBias": "=lookup(roomBias, 'temple')",
    "room_type": "=pick(#_roomBias)",
    "narrative": "=lookup(roomNarrative, #room_type)",
    "room_size": "=oneOf(tiny, small, medium, large, enormous)",
    "_encounterChance": "=1",
    "_treasureChance": "=if(#room_type == \"treasury\", 1.0, oneOf(0.5, 0.8))",
    "targetCr": "=#_targetCr + max(1,round(#_index-1))",
    "challenging": false,
    "encounter": "=if(rand() < #_encounterChance, gen(encounter), nihil)",
    "treasure": "=if(rand() < #_treasureChance, lookup(treasure, oneOf(negligible, minor)), nihil)",
    "feature": "=lookup(roomDecoration, 1d100)"
  },
  "boss_room": {
    "_targetCr": 1,
    "depth": 0,
    "race": "goblin",
    "challenging": true,
    "room_type": "=oneOf(throne_room, lair, altar)",
    "narrative": "=lookup(roomNarrative, #room_type)",
    "room_size": "=oneOf(medium, large, enormous, huge, colossal)",
    "targetCr": "=#_targetCr + round(#depth)",
    "_companionCount": 1,
    "_monsterCount": 1,
    "treasure": "=lookup(treasure, oneOf(major, legendary))",
    "type": "=lookup(bossMonsterType, #race)",
    "boss_encounter": "=gen(encounter)",
    "feature": "=lookup(roomDecoration, 1d100)"
  },
  "dungeon": {
    "terrain": "=oneOf(forest, cave, swamp, mountain, snow, desert)",
    "_index": "0",
    "_targetCr": "=max(1, (#_index-1)*2)",
    "_building_type": "=oneOf(temple, fortress, library, tomb, mine)",
    "_roomBias": "=lookup(roomBias, #_building_type)",
    "dungeon_type": "=lookup(dungeonTypes, #_building_type)",
    "race": "=if(#_targetCr <= 3, oneOf(goblin, kobold), if(#_targetCr <= 6, oneOf(orc, human), if(#_targetCr <= 10, oneOf(ogre, troll), oneOf(dragon))))",
    "theme": "=oneOf(pain, power, darkness, nature, fire, ice, shadow, light, chaos, order, water, air, earth, lightning, death, life, time, mystery)",
    "aspect": "=lookup(dungeonAspect, #_building_type)",
    "dungeon_name": "=capitalize(#aspect) + \" \" + capitalize(#race) + \" \" + capitalize(#dungeon_type) + \" of \" + capitalize(#theme)",
    "depth": "=2+1d4",
    "dungeonIndex": "=#_index",
    "intendedCr": "=#_targetCr",
    "rooms": "=genList(room, #depth)",
    "bossRoom": "=gen(boss_room)",
    "direction": "=oneOf(north, south, east, west)",
    "rumor": "=eval(lookup(dungeonRumor, #_building_type))"
  },
  
  "module": {
    "terrain": "=lookup(terrains, 1d6)",
    "town": "=gen(town)",
    "dungeons": "=genList(dungeon, 3+1d4)",
    "name": "=oneOf('Quest', 'Adventure', 'Saga') + ' in the ' + capitalize(#terrain)"
  }
}